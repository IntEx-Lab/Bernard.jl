# ExprBuild 项目介绍

ExprBuild 是一个独立开发和AI协作开发的项目。开发者正在尝试不同的技术路线，本项目工程是基于 Julia 语言的，开发者希望能在这个工程里面学习和验证关键概念，判断 Julia 是否可以成为可选的技术路线，如果可能的话再将工程演进到更成熟的产品形态。

由于开发者需要和AI协作开发，故需要 working-notes 文件夹用于放置“笔记”式的信息文件，供开发者和 AI 同时使用，为每一个新的 AI 示例提供背景信息，以便 AI 理解和工作。请合理使用 working-notes 文件夹，以便开发者和 AI 可以随时查阅和更新信息。

补充信息：
- 开发者有其他语言的编程技术基础，但没有太多的 Julia 编程经验。

以下介绍分为两部分：第一部分介绍 ExprBuild 的核心目标与愿景，第二部分则是对各个技术路线的探索。这里是关于 Julia 技术路线的探索。

## 第一部分：核心目标与愿景

### 项目概述

ExprBuild 是一个为 Desmos 图形计算器爱好者设计的开发框架，旨在通过编程方式构建和管理复杂的 Desmos 图表。作为 Desmos 社区粉丝项目，ExprBuild 致力于简化复杂图表的创建过程，使得制作新奇、互动性强的 Desmos 作品变得更加便捷高效。

### 核心目标

1. **降低复杂度**：通过编程方式管理大量表达式，克服 Desmos 原生界面在处理复杂图表时的局限性

2. **自然的数学表达**：提供尽可能接近数学习惯的语法，让创作者能直观地编写表达式，不必过多考虑语法调整

3. **依赖关系管理**：自动追踪和处理表达式之间的依赖关系，确保图表内部公式系统的一致性

4. **实时反馈循环**：提供高效的开发体验，表达式修改后能立即在预览中查看效果

5. **可程序化操作**：将表达式作为可操作对象，利用编程语言的优势进行批量生成、转换和组织

### 愿景

ExprBuild 希望成为 Desmos 社区创作者的得力助手，通过消除技术障碍，释放创作者的想象力。无论是制作数学游戏、动画展示、复杂可视化，还是艺术作品，ExprBuild 都能提供必要的工具支持，使 Desmos 创作不再受限于原生界面的约束。

### 社区定位

ExprBuild 首先是一个 Desmos 社区粉丝项目，专注于服务社区创作者的需求。我们关注的是如何帮助爱好者制作出更加新奇、复杂的 Desmos 图表，如小游戏、艺术作品或复杂数学演示，而非追求正式的数学或科学研究工具的定位。

## 第二部分：Julia 技术路线探索

### Julia 语言选择理由

Julia 作为 ExprBuild 的实现语言具有显著优势：

1. **自然的数学语法**：Julia 的语法极其接近数学表达习惯，支持隐式乘法（如 `2x` 表示 `2*x`）、Unicode 数学符号（如 `√`, `π`）和标准数学运算符优先级

2. **强大的元编程能力**：Julia 的宏系统允许直接操作和转换代码的抽象语法树，非常适合构建表达式处理框架

3. **科学计算生态**：丰富的数学和科学计算库，特别是符号计算库如 `Symbolics.jl`，为表达式处理提供强大支持

### 技术架构设计

在 Julia 路线下，ExprBuild 可采用以下架构：

```
+------------------+        +----------------+        +---------------+
| 核心表达式系统   |  <-->  | Genie.jl 服务器 |  <-->  | JavaScript前端 |
| (Julia)          |        | (Julia)        |        | (Web浏览器)    |
+------------------+        +----------------+        +---------------+
```

#### 1. 核心表达式系统

利用 Julia 的符号计算能力和宏系统实现：

```julia
# 定义核心表达式类型
abstract type ExprNode end

# 使用宏捕获表达式
macro expl(expr)
    # 分析表达式并创建适当的ExprNode对象
    return :(parse_expression($(QuoteNode(expr))))
end

# 示例用法
a = @expl a = 3
b = @expl b = 4
circle = @expl x^2 + y^2 = $(a)^2 + $(b)^2
```

这种设计允许直接使用 Julia 的自然数学语法编写表达式，同时通过宏系统捕获和处理这些表达式。

#### 2. Genie.jl 服务器方案

使用 Genie.jl 框架提供 Web 服务：

- **API 端点**：提供 RESTful 接口处理表达式操作和 Desmos 状态生成
- **WebSocket 支持**：实现实时预览和双向通信
- **会话管理**：处理多用户和项目状态

```julia
# Genie.jl 路由示例
route("/api/compile") do
    # 接收表达式数据
    expr_data = jsonpayload()
    # 处理并返回 Desmos 状态
    desmos_state = compile_to_desmos(expr_data)
    return json(desmos_state)
end
```

#### 3. JavaScript 前端

前端负责用户交互和 Desmos API 集成：

- **代码编辑器**：基于 Monaco Editor 或 CodeMirror，支持语法高亮
- **Desmos 预览**：嵌入 Desmos API 展示生成结果
- **智能提示**：与服务器通信提供上下文相关的代码补全

### 依赖追踪与表达式管理

Julia 路线的一个关键优势是利用 `Symbolics.jl` 或自定义实现进行依赖追踪：

```julia
# 使用符号系统追踪依赖
using Symbolics

@variables x y a b
expr1 = a^2 + b^2
expr2 = x^2 + y^2 ~ expr1

# 找出依赖关系
dependencies = find_dependencies(expr2)  # 返回 [a, b]

# 替换变量生成最终表达式
final_expr = substitute(expr2, Dict(a => 3, b => 4))
```

### 开发体验优化

为提供流畅的开发体验，Julia 路线采用：

1. **热重载功能**：代码更改后自动重新编译和更新预览
2. **增量更新**：只重新计算受影响的表达式
3. **代码生成**：支持从 Desmos 状态反向生成 ExprBuild 代码

### 技术挑战与解决方案

1. **性能考量**：
   - 挑战：Julia 初次加载时间长
   - 解决方案：使用 PackageCompiler.jl 创建系统映像，减少启动时间

2. **前后端集成**：
   - 挑战：Julia 与 JavaScript 生态系统的无缝集成
   - 解决方案：明确的 JSON API 设计和 WebSocket 实时通信

3. **部署复杂性**：
   - 挑战：Julia 应用部署不如其他语言成熟
   - 解决方案：提供 Docker 容器化配置和详细部署指南

### Julia 路线的独特优势

1. **数学表达的纯粹性**：在所有备选方案中，Julia 提供最接近数学原生表达的语法
2. **符号计算能力**：内置强大的符号计算支持，简化表达式处理
3. **科学计算生态**：可以轻松扩展到更复杂的数学功能

### 未来扩展方向

1. **自定义绘图函数**：扩展 Desmos 的基本功能，支持更复杂的绘图操作
2. **动画序列生成**：创建数学动画的工具
3. **社区模板库**：共享和复用常用图表模板

---

ExprBuild 作为 Desmos 社区的粉丝项目，不追求成为正式的数学研究工具，而是专注于赋能创作者制作更加新奇、复杂的 Desmos 作品。Julia 技术路线提供了在数学表达自然性和编程灵活性之间的理想平衡，特别适合那些希望突破 Desmos 原生界面限制的社区创作者。