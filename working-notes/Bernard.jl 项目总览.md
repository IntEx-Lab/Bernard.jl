# Bernard.jl 项目总览

> 本项目原名 ExprBuild-Julia/ExprBuild，现更名为 Bernard.jl。

本文件为 Bernard.jl 项目的总览，面向AI助手和开发者，帮助快速了解项目全貌。

## 项目愿景

### 原始定位
- Bernard.jl 是一个独立开发和AI协作开发的项目，旨在为 Desmos 图形计算器爱好者提供一个开发框架，通过编程方式构建和管理复杂的 Desmos 图表。
- 作为 Desmos 社区粉丝项目，Bernard.jl 致力于简化复杂图表的创建过程，使得制作新奇、互动性强的 Desmos 作品变得更加便捷高效。
- 原本专注于一般Julia开发环境场景，作为辅助创作库帮助开发者通过编程方式管理大量表达式，克服 Desmos 原生界面在处理复杂图表时的局限性。

### 与JuliaCanvas的集成愿景
- **集成动机**：在开发JuliaCanvas（Para/Parasee项目的第一个原型）时，发现可以将Bernard.jl与画布式编程环境结合，创建一个"能够在画布里同时写代码和看desmos图象，帮助desmos粉丝的图象创作工作"的应用。
- **设计理念验证**：通过这种集成快速验证JuliaCanvas的核心设计理念：画布式、交互式、声明式/响应式创作。
- **技术选择考量**：为了与Bernard.jl深度集成，JuliaCanvas选择了Julia语言而非架构更简单的JavaScript，体现了两个项目的紧密协作关系。
- **目标用户扩展**：从面向有编程经验的Desmos爱好者，扩展到希望通过可视化编程界面进行Desmos创作的更广泛用户群体。

### JuliaCanvas项目简介
JuliaCanvas是一个画布式的Julia代码环境，是Para/Parasee项目的第一个原型，探索画布式、交互式、声明式创作工具的开发：
- **画布式编程**：在画布上创建和编辑代码块，支持拖拽、缩放等操作，代码块组合成完整工程
- **交互式编程**：支持交互式变量，通过滑动条、输入框等控件进行实时调节
- **声明式/响应式创作**：数据变更自动同步到所有依赖元素，减少重复劳动
- **Bernard.jl集成**：通过Bernard.jl实现Julia代码与Desmos图表的无缝衔接

## 项目定位与职责边界
- **核心职责**：专注于提供公式对象的工程化、可编程化、可扩展性组合框架
- **职责边界**：不涉及Desmos内部的求值过程，不深入处理动态计算机制
- **检查范围**：提供有限但必要的检查，主要包括基本的依赖关系检查和符号兼容性验证
- **错误处理原则**：不关心用户在具体求值过程中可能犯下的错误，允许有目的地产生和保留某些错误状态

## 核心目标
1. **降低复杂度**：通过编程方式管理大量表达式，克服 Desmos 原生语言与界面在处理复杂图表时的局限性
2. **自然的数学表达**：提供尽可能接近数学习惯的语法，让创作者能直观地编写表达式
3. **可程序化操作**：将表达式作为可操作对象，利用编程语言的优势进行批量生成、转换和组织
4. **可扩展性支持与依赖关系管理**：在允许用户开发可扩展的公式组的同时，提供有效的机制在 Julia 层内组合过程中自动追踪和处理表达式之间的依赖关系，确保图表内部公式系统的一致性，消除符号依赖关系方面的错误
5. **符号转换功能**：提供运行时的符号重命名功能，将Julia中高自由度的符号名转换为Desmos支持的相对有限的"单字符+下标"格式，并在调试场景中提供还原回原始符号名的符号还原功能
6. **实时反馈循环**：提供高效的开发体验，表达式修改后能立即在预览中查看效果

## JuliaCanvas集成计划
Bernard.jl 与JuliaCanvas项目的深度集成设计：

### 集成背景
- **项目关系**：JuliaCanvas是Para/Parasee项目的第一个原型，Bernard.jl为其提供Desmos相关的核心功能支持
- **技术协作**：JuliaCanvas选择Julia语言主要是为了与Bernard.jl深度集成，尽管JavaScript可能提供更简单的前端架构
- **用户体验目标**：在画布中使用Bernard.jl进行Desmos图表创作，实现代码编写与图象预览的无缝衔接

### JuliaCanvas核心功能
- **画布式编程**：用户在画布中放置Julia代码片段，通过拖拽和连接组合它们
- **交互式控件**：通过滑动条、输入框等控件调整代码中的变量，实现参数的动态调整
- **实时执行**：代码片段支持实时执行和结果展示
- **Bernard.jl集成**：通过Bernard.jl实现Julia表达式到Desmos图表的转换和预览

### 集成架构设计
- **Desmos预览嵌入**：在JuliaCanvas中嵌入Desmos作为web组件进行实时预览
- **三模块布局**：画布中的Desmos预览区域从左到右包含三个模块：
  1. **Desmos图象区**：去除原生公式列表UI，仅保留图象显示区域
  2. **重命名后公式列表**：使用自定义UI显示Desmos中的公式列表和错误信息（构建时已进行符号重命名）
  3. **Julia对象详解**：平行展示的Julia图表对象信息，与重命名后的公式列表一一对应，显示构建前未经重命名的原始符号信息

### 技术选择考量
- **Julia vs JavaScript**：虽然JavaScript可能提供更简单的前端架构，但为了与Bernard.jl深度集成，JuliaCanvas选择了Julia后端
- **未来扩展**：也在考虑Bernard.js的可能性，但JavaScript方案在Bernard库这一边会比Julia方案复杂得多
- **原型优先**：当前优先完成Julia版本的原型验证，为后续技术栈决策提供经验基础

### 应用符号转换功能
- **符号重命名**：将Julia中不符合Desmos命名规则的符号（多字符名称、命名空间等）转换为Desmos支持的"单字符+下标"格式
- **符号还原**：在JuliaCanvas中将Desmos的受限符号名还原回原始的Julia符号名，保持开发时的可读性
- **双向映射**：维护Julia对象与Desmos表达式之间的双向映射关系
- **错误追踪**：将Desmos运行时的错误信息映射回对应的Julia对象
- **实时同步**：支持Julia对象修改后的实时更新和状态同步

## 开发者发展目标
- **技术栈评估与选择**：已确定采用Julia作为唯一技术路线
- **对象模型设计**：探索使用现有库(如Symbolics.jl)或自建对象系统对Desmos公式系统进行建模
- **Desmos机制建模**：完成对Desmos计算原理的建模，重点关注符号系统、公式类型、依赖关系等静态特性
- **AI协作开发模式探索**：建立有效的人机协作开发流程，积累AI辅助开发的最佳实践

## 技术路线探索

我们当前面临两个主要的技术选择点：

### 1. 编程语言选择
- **Julia**：自然的数学语法、强大的元编程能力、丰富的科学计算生态

### 2. 表达式建模方法
- **使用Symbolics.jl**：利用Julia已有的符号计算库
- **自建对象系统**：专门设计针对Desmos公式系统的对象模型

## 主要协作方式
- 以 working-notes 文件夹作为 AI 与人类开发者的知识库和沟通桥梁
- 所有背景、进度、任务、决策等信息均在此归档
- working-notes 文件夹是面向AI的，需确保新的AI助手能通过阅读获取所有必要信息

## working-notes 文件夹结构

```
working-notes/
├── 项目总览.md           # 项目总览，面向AI助手和开发者的入口文档
├── 技术笔记.md           # 技术细节、方案、实现思路等笔记
├── 历史记录.md           # 项目进展、决策、重要事件的时间线归档
├── FAQ.md                # 常见问题与解答
├── AI协作指南.md         # AI与人类协作开发的操作指引
├── to-ai buffer.md       # 临时与AI交互、待处理内容缓冲区
├── drafts/               # 草稿区，存放各类未定稿文档
├── legacy/               # 历史遗留文档、旧版本资料
├── Desmos建模/           # Desmos公式系统建模相关资料
│   └── 公式系统.md
├── Julia路线/            # Julia相关技术路线、方案探索
│   └── 技术方案.md
├── working-notes template A/   # 结构化知识模板A，含草稿与历史
├── working-notes template B/   # 结构化知识模板B，含示例与通用笔记
```

> 说明：
> - working-notes/ 作为知识库和沟通桥梁，归档所有背景、进度、任务、决策等信息。
> - drafts/ 和 legacy/ 用于管理不同阶段的文档。
> - template A/B/... 由开发者从其他地方收集的不同风格的知识组织模板，暂存，以备在这里应用。
> - 其余子文件夹按主题归档相关资料。

## 补充信息
- 开发者有其他语言的编程技术基础，但没有太多的 Julia 编程经验
- 如果开发者修改了项目介绍，介绍文本可能会跟实际代码工程脱节，默认以文档为准
- README文档暂缓上线，已重命名为 wip-README.md，待项目完工后再完成 README 文档 