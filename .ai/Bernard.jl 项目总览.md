# Bernard.jl 项目总览

> 本项目原名 ExprBuild-Julia/ExprBuild，现更名为 Bernard.jl。

本文件为 Bernard.jl 项目的总览，面向AI助手和开发者，帮助快速了解项目全貌。

## 项目结构
```
项目根目录/
├── Bernard.jl/           # Julia路线源代码
│   ├── src/              # Julia核心库源码
│   ├── examples/         # Julia使用示例
│   ├── test/             # Julia测试代码
│   ├── Project.toml      # Julia项目配置
│   └── Manifest.toml     # Julia依赖锁定文件
├── Bernard.js/           # JavaScript路线探索（尚未开始实现）
├── README.md             # 项目简介
└── wip-README.md         # 待完成的README文档
```

## 项目愿景

### 原始定位
- Bernard.jl 是一个独立开发和AI协作开发的项目，旨在为 Desmos 图形计算器爱好者提供一个开发框架，通过编程方式构建和管理复杂的 Desmos 图表。
- 作为 Desmos 社区粉丝项目，Bernard.jl 致力于简化复杂图表的创建过程，使得制作新奇、互动性强的 Desmos 作品变得更加便捷高效。
- 原本专注于一般Julia开发环境场景，作为辅助创作库帮助开发者通过编程方式管理大量表达式，克服 Desmos 原生界面在处理复杂图表时的局限性。

### 与JuliaCanvas的集成愿景
- **集成动机**：在开发JuliaCanvas（Para/Parasee项目的第一个原型）时，发现可以将Bernard.jl与画布式编程环境结合，创建一个"能够在画布里同时写代码和看desmos图象，帮助desmos粉丝的图象创作工作"的应用。
- **设计理念验证**：通过这种集成快速验证JuliaCanvas的核心设计理念：画布式、交互式、声明式/响应式创作。
- **技术选择考量**：为了与Bernard.jl深度集成，JuliaCanvas选择了Julia语言而非架构更简单的JavaScript，体现了两个项目的紧密协作关系。
- **目标用户扩展**：从面向有编程经验的Desmos爱好者，扩展到希望通过可视化编程界面进行Desmos创作的更广泛用户群体。

### JuliaCanvas项目简介
JuliaCanvas是一个画布式的Julia代码环境，是Para/Parasee项目的第一个原型，探索画布式、交互式、声明式创作工具的开发：
- **画布式编程**：在画布上创建和编辑代码块，支持拖拽、缩放等操作，代码块组合成完整工程
- **交互式编程**：支持交互式变量，通过滑动条、输入框等控件进行实时调节
- **声明式/响应式创作**：数据变更自动同步到所有依赖元素，减少重复劳动
- **Bernard.jl集成**：通过Bernard.jl实现Julia代码与Desmos图表的无缝衔接

## 项目定位与职责边界
- **核心职责**：专注于提供公式对象的工程化、可编程化、可扩展性组合框架
- **职责边界**：不涉及Desmos内部的求值过程，不深入处理动态计算机制
- **检查范围**：提供有限但必要的检查，主要包括基本的依赖关系检查和符号兼容性验证
- **错误处理原则**：不关心用户在具体求值过程中可能犯下的错误，允许有目的地产生和保留某些错误状态

## 核心目标
1. **降低复杂度**：通过编程方式管理大量表达式，克服 Desmos 原生语言与界面在处理复杂图表时的局限性
2. **自然的数学表达**：提供尽可能接近数学习惯的语法，让创作者能直观地编写表达式
3. **可程序化操作**：将表达式作为可操作对象，利用编程语言的优势进行批量生成、转换和组织
4. **可扩展性支持与依赖关系管理**：在允许用户开发可扩展的公式组的同时，提供有效的机制在 Julia 层内组合过程中自动追踪和处理表达式之间的依赖关系，确保图表内部公式系统的一致性，消除符号依赖关系方面的错误
5. **符号转换功能**：提供运行时的符号重命名功能，将Julia中高自由度的符号名转换为Desmos支持的相对有限的"单字符+下标"格式，并在调试场景中提供还原回原始符号名的符号还原功能
6. **实时反馈循环**：提供高效的开发体验，表达式修改后能立即在预览中查看效果

## JuliaCanvas集成计划
Bernard.jl 与JuliaCanvas项目的深度集成设计：

### 集成背景
- **项目关系**：JuliaCanvas是Para/Parasee项目的第一个原型，Bernard.jl为其提供Desmos相关的核心功能支持
- **技术协作**：JuliaCanvas选择Julia语言主要是为了与Bernard.jl深度集成，尽管JavaScript可能提供更简单的前端架构
- **用户体验目标**：在画布中使用Bernard.jl进行Desmos图表创作，实现代码编写与图象预览的无缝衔接

### JuliaCanvas核心功能
- **画布式编程**：用户在画布中放置Julia代码片段，通过拖拽和连接组合它们
- **交互式控件**：通过滑动条、输入框等控件调整代码中的变量，实现参数的动态调整
- **实时执行**：代码片段支持实时执行和结果展示
- **Bernard.jl集成**：通过Bernard.jl实现Julia表达式到Desmos图表的转换和预览

### 集成架构设计
- **Desmos预览嵌入**：在JuliaCanvas中嵌入Desmos作为web组件进行实时预览
- **三模块布局**：画布中的Desmos预览区域从左到右包含三个模块：
  1. **Desmos图象区**：去除原生公式列表UI，仅保留图象显示区域
  2. **重命名后公式列表**：使用自定义UI显示Desmos中的公式列表和错误信息（构建时已进行符号重命名）
  3. **Julia对象详解**：平行展示的Julia图表对象信息，与重命名后的公式列表一一对应，显示构建前未经重命名的原始符号信息

### 技术选择考量
- **Julia vs JavaScript**：虽然JavaScript可能提供更简单的前端架构，但为了与Bernard.jl深度集成，JuliaCanvas选择了Julia后端
- **未来扩展**：也在考虑Bernard.js的可能性，但JavaScript方案在Bernard库这一边会比Julia方案复杂得多
- **原型优先**：当前优先完成Julia版本的原型验证，为后续技术栈决策提供经验基础

### 应用符号转换功能
- **符号重命名**：将Julia中不符合Desmos命名规则的符号（多字符名称、命名空间等）转换为Desmos支持的"单字符+下标"格式
- **符号还原**：在JuliaCanvas中将Desmos的受限符号名还原回原始的Julia符号名，保持开发时的可读性
- **双向映射**：维护Julia对象与Desmos表达式之间的双向映射关系
- **错误追踪**：将Desmos运行时的错误信息映射回对应的Julia对象
- **实时同步**：支持Julia对象修改后的实时更新和状态同步

## 开发者发展目标
- **技术栈评估与选择**：已确定采用Julia作为主要技术路线，同时探索JavaScript路线的可能性
- **对象模型设计**：探索使用现有库(如Symbolics.jl)或自建对象系统对Desmos公式系统进行建模
- **Desmos机制建模**：完成对Desmos计算原理的建模，重点关注符号系统、公式类型、依赖关系等静态特性
- **AI协作开发模式探索**：建立有效的人机协作开发流程，积累AI辅助开发的最佳实践

## 技术路线探索

### 1. 主要技术路线：Julia
- **Julia**：自然的数学语法、强大的元编程能力、丰富的科学计算生态
- **确定性**：已确定为主要开发路线，源代码位于`Bernard.jl/`目录

### 2. 探索性技术路线：JavaScript
- **动机**：为画布应用场景提供架构简化的可能性
- **优势**：在纯前端画布应用中避免前后端分离的复杂性
- **挑战**：表达式建模复杂度显著高于Julia路线
- **现状**：仍在技术可行性分析阶段，相关文档见`working-notes/JS路线/`

### 3. 表达式建模方法（Julia路线）
- **使用Symbolics.jl**：利用Julia已有的符号计算库
- **自建对象系统**：专门设计针对Desmos公式系统的对象模型

## JavaScript路线补充说明
基于对JavaScript路线的深入分析，其主要考虑场景为：
- **纯前端画布应用**：在基于React-flow等技术的纯前端画布应用中，JS路线可以避免前后端分离带来的架构复杂性
- **技术权衡**：虽然JavaScript在数学表达自然性和符号计算能力上不如Julia，但在特定的画布应用架构中具有集成优势
- **开发优先级**：作为探索性方案，优先级低于Julia路线的完成

## 补充信息
- 开发者有其他语言的编程技术基础，但没有太多的 Julia 编程经验；
- 实际代码可能会跟项目文档脱节，优先以文档为准；
- README文档暂缓上线，已重命名为 wip-README.md，待项目完工后再完成 README 文档；


## FAQ

> 注：开发者刚搬运过来，内容需要检查。

### Q: Bernard.jl 与 Desmos 的官方 API 有什么区别？
A: Bernard.jl 是一个社区粉丝项目，不是 Desmos 官方产品。它提供了一个编程框架来构建 Desmos 图表，而 Desmos 官方 API 主要是为了在网页中嵌入 Desmos 计算器。

### Q: 为什么选择 Julia 作为潜在的实现语言？
A: Julia 的语法极其接近数学表达习惯，支持隐式乘法、Unicode 数学符号和标准数学运算符优先级，同时具有强大的元编程能力和丰富的科学计算生态。

### Q: 使用 Symbolics.jl 和自建对象系统各有哪些优劣势？
A: Symbolics.jl 可以充分利用 Julia 已有的符号计算能力，但可能需要适配 Desmos 特性；自建对象系统能更精确设计符合 Desmos 特性的模型，但开发工作量大。

### Q: Bernard.jl 如何处理 Desmos 表达式之间的依赖关系？
A: Bernard.jl 设计了依赖管理系统，包括依赖识别、依赖图构建、冲突检测和变量替换优化，确保表达式之间的依赖关系符合 Desmos 的约束规则。

### Q: 项目的当前主要挑战是什么？
A: 当前主要挑战包括：完善对 Desmos 机制的建模、决定使用 Julia 还是其他语言、选择使用现有符号计算库还是自建对象系统等。

### Q: Bernard.jl 与其他数学软件的关系是什么？
A: Bernard.jl 专注于 Desmos 图形计算器，不是一个通用的数学软件。它的目标是帮助 Desmos 社区创作者更便捷地创建复杂的 Desmos 图表，而非替代 Mathematica、MATLAB 等专业数学工具。