# JuliaCanvas 集成方案

> Bernard.jl 与 JuliaCanvas 项目的深度集成设计方案，详细描述两个项目的协作架构和技术实现。

## 集成背景

### 项目关系与定位
- **项目关系**：JuliaCanvas是Para/Parasee项目的第一个原型，Bernard.jl为其提供Desmos相关的核心功能支持
- **技术协作**：JuliaCanvas选择Julia语言主要是为了与Bernard.jl深度集成，尽管JavaScript可能提供更简单的前端架构
- **用户体验目标**：在画布中使用Bernard.jl进行Desmos图表创作，实现代码编写与图象预览的无缝衔接

### 集成动机与愿景
- **集成动机**：在开发JuliaCanvas（Para/Parasee项目的第一个原型）时，发现可以将Bernard.jl与画布式编程环境结合，创建一个"能够在画布里同时写代码和看desmos图象，帮助desmos粉丝的图象创作工作"的应用。
- **设计理念验证**：通过这种集成快速验证JuliaCanvas的核心设计理念：画布式、交互式、声明式/响应式创作。
- **技术选择考量**：为了与Bernard.jl深度集成，JuliaCanvas选择了Julia语言而非架构更简单的JavaScript，体现了两个项目的紧密协作关系。
- **目标用户扩展**：从面向有编程经验的Desmos爱好者，扩展到希望通过可视化编程界面进行Desmos创作的更广泛用户群体。

## JuliaCanvas 项目简介

JuliaCanvas是一个画布式的Julia代码环境，是Para/Parasee项目的第一个原型，探索画布式、交互式、声明式创作工具的开发：

- **画布式编程**：在画布上创建和编辑代码块，支持拖拽、缩放等操作，代码块组合成完整工程
- **交互式编程**：支持交互式变量，通过滑动条、输入框等控件进行实时调节
- **声明式/响应式创作**：数据变更自动同步到所有依赖元素，减少重复劳动
- **Bernard.jl集成**：通过Bernard.jl实现Julia代码与Desmos图表的无缝衔接

## 集成架构设计

### JuliaCanvas核心功能
- **画布式编程**：用户在画布中放置Julia代码片段，通过拖拽和连接组合它们
- **交互式控件**：通过滑动条、输入框等控件调整代码中的变量，实现参数的动态调整
- **实时执行**：代码片段支持实时执行和结果展示
- **Bernard.jl集成**：通过Bernard.jl实现Julia表达式到Desmos图表的转换和预览

### 三模块布局设计
- **Desmos预览嵌入**：在JuliaCanvas中嵌入Desmos作为web组件进行实时预览
- **三模块布局**：画布中的Desmos预览区域从左到右包含三个模块：
  1. **Desmos图象区**：去除原生公式列表UI，仅保留图象显示区域
  2. **重命名后公式列表**：使用自定义UI显示Desmos中的公式列表和错误信息（构建时已进行符号重命名）
  3. **Julia对象详解**：平行展示的Julia图表对象信息，与重命名后的公式列表一一对应，显示构建前未经重命名的原始符号信息

## 符号转换功能应用

### 核心功能
- **符号重命名**：将Julia中不符合Desmos命名规则的符号（多字符名称、命名空间等）转换为Desmos支持的"单字符+下标"格式
- **符号还原**：在JuliaCanvas中将Desmos的受限符号名还原回原始的Julia符号名，保持开发时的可读性
- **双向映射**：维护Julia对象与Desmos表达式之间的双向映射关系

### 实际应用场景
- **错误追踪**：将Desmos运行时的错误信息映射回对应的Julia对象
- **实时同步**：支持Julia对象修改后的实时更新和状态同步
- **开发体验**：在JuliaCanvas界面中保持Julia的原始符号可读性，同时确保Desmos兼容性

## 技术选择考量

### Julia vs JavaScript
- **Julia优势**：与Bernard.jl深度集成，自然的数学语法支持，强大的符号计算能力
- **JavaScript考量**：虽然JavaScript可能提供更简单的前端架构，但为了与Bernard.jl深度集成，JuliaCanvas选择了Julia后端
- **架构权衡**：在前后端分离的复杂性与集成便利性之间做出的技术选择

### 未来扩展
- **Bernard.js可能性**：也在考虑Bernard.js的可能性，但JavaScript方案在Bernard库这一边会比Julia方案复杂得多
- **原型优先**：当前优先完成Julia版本的原型验证，为后续技术栈决策提供经验基础
- **技术验证**：通过集成实践验证画布式编程环境的可行性和用户体验 